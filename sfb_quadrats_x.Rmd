---
title: "SFBay Rocky Shore Survey analyses"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
author: "Karina J. Nielsen"
date: "Last compiled on `r format(Sys.time(), '%d %B %Y')`"
output:
   bookdown::html_document2: default
---

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  fig.align = "left",
  fig.width = 6,
  fig.height = 4,
  dev = "png",
  cache = TRUE
)


# echo = FALSE means code will not print, by default
#cache = TRUE saves output results of all chunks so that they do not need to be rerun

```

```{r library, include=FALSE}
library("easypackages")
my_packages <- c("renv", "easypackages",  "here", "ggthemes", "gridExtra", "tidyverse", "lubridate", "patchwork", "tinytex", "bookdown", "ggpubr", "wesanderson", "pals", "ggridges", "hrbrthemes", "viridis", "dplyr", "here", "readr", "httr", "RcolorBrewer", "skimr", "pheatmap" ) 
libraries(my_packages)

# Install packages if needed
# install.packages("easypackages")
# packages(my_packages) 

# checks to make sure the packages needed are loaded and asks before installing to confirm install in the console window
```

```{r renv, include=FALSE}
#Track/maintain package versions in workflow

#renv::init # to initialize a new project-local environment with a private R library
#run as needed later in the project to capture required package versions

renv::snapshot() 

#NB must respond and affirm actions in console or you will see the spinning wheel....
#reference for renv workflow: https://rstudio.github.io/renv/articles/renv.html

```

```{r functions}

#As needed...

```

```{r here, include=FALSE}

## Confirm working directory for project
here::here() # use this to work with sub-directories less awkwardly and share projects across users/machines more easily.
```


```{r read, message=FALSE}
##Reads in *.csv data files to tibbles and keeps first row as column names

rqs <- read_csv(here::here ("data","sfbay_rockweed_quadrat_surveys.csv"), col_names = TRUE) 
rqs.loc <- read_csv(here::here ("data","sfbay_rockweed_site_names_locations.csv"), col_names = TRUE) 
sizes <- read_csv(here::here ("data","sfbay_rockweed_quadrat_invert_sizes.csv"), col_names = TRUE)
rich <- read_csv(here::here ("data","sfbay_richness_site_sum.csv"), col_names = TRUE)
phys <- read_csv(here::here ("data","sfbay_physical_site_sum.csv"), col_names = TRUE)
cover <- read_csv(here::here ("data","pct_cover_by_transects.csv"), col_names = TRUE)
coverbio <- read_csv(here::here ("data","pct_cover_by_transects_biol.csv"), col_names = TRUE)
hmextra <- read_csv(here::here ("data","heatmap_extra.csv"), col_names = TRUE)
```


```{r wrangle, include=FALSE}

# converts first column of a tibble into row names for heatmap function
cover2 <- column_to_rownames(coverbio, var = "ftu")
coverbio2 <- column_to_rownames(coverbio, var = "ftu")
#coverbio_wide_s <- column_to_rownames(coverbio_wide_s, var = "ftu")

# converts wide format data to long format
cover_long <- cover %>% 
  pivot_longer(!ftu, names_to = "site_tran", values_to = "cover")
#converts NAs to 0
cover_long[is.na(cover_long)] <- 0

# separates site_tran variable into site and tran (has a common delimiter)
cover_long_s <- separate(cover_long, site_tran, into = c("site", "tran"))

# converts wide format data to long format
coverbio_long <- coverbio %>% 
  pivot_longer(!ftu, names_to = "site_tran", values_to = "cover")
#converts NAs to 0
coverbio_long[is.na(coverbio_long)] <- 0

# separates site_tran variable into site and tran (has a common delimiter)
coverbio_long_s <- separate(coverbio_long, site_tran, into = c("site", "tran"))

# Summarise mean cover by ftu and site
coverbio_long_sitesum <- coverbio_long_s %>%
group_by(site,ftu) %>%
summarise(cover_x = mean(cover))

# pivots to wide format for heatmap
coverbio_wide_s <- coverbio_long_sitesum %>%
  pivot_wider(names_from = site, values_from = cover_x)


# Updates rqs$date formatting from chr to POSIXct
rqs <- mutate(rqs, date = as.POSIXct(rqs$date, tz = "America/Los_Angeles", format = "%m/%d/%Y")) 

# Convert zone character variable to factor variable with ordered levels
rqs <- mutate(rqs, zone = as.factor(rqs$zone))
ordered(rqs$zone, levels = c("Low", "Mid", "High"))

#convert site names to ordered factor - ordered around bay perimeter from SF Marina to Miller Knox
rqs <- rename(rqs, site_name = site)
rqs <- mutate(rqs, site_name = as.factor(rqs$site_name))
ordered(
  rqs$site_name,
  levels = c(
    "SF Marina",
    "Horseshoe Bay",
    "Dunphy Park",
    "Brickyard Park",
    "RTC Beach",
    "RTC Theater",
    "RTC North Dock",
    "Pt. Chauncey",
    "Pt. Chauncey Beach S",
    "Pt. Chauncey Beach N",
    "Paradise Beach Park",
    "Paradise Cay",
    "San Quentin Beach",
    "Starkweather Park",
    "Pt. San Pablo",
    "Pt. Orient N",
    "Pt. Orient S",
    "Pt. Molate",
    "Keller Beach",
    "Miller Knox"
  )
)


# merges rqs and rqs.loc by site codes

rqs2 <- dplyr::full_join(rqs, rqs.loc, by = "site_code")
rqs2

# creates column with RTC vs. all other sites for 'spotlighting" in graphs, reorders some columns

rqs3 <- rqs2 %>% 
  mutate(RTC_sites = case_when(
        site_code %in% c("PBS", "PCR", "PCW", "PCB", "PCC", "RTCR", "RTCC", "RTCS", "SQB")  ~ "RTC",
        site_code %in% c("SWR", "SFMS", "RRR", "POC", "POB", "PMB", "MKR", "KBB", "HBR", "DPR", "BPB")  ~ "other"),
        .after = site_name.x
  )%>%
  relocate(lat, .after = site_code)%>%
  relocate(long, .after = lat)%>%
  relocate(bay_perim_order, .after = site_code) %>% 
  mutate(bay_perim_order = as.factor(bay_perim_order))


rqs3$RTC_sites <- ordered(rqs3$RTC_sites, levels = c("RTC", "other")) 
rqs3 <- rename(rqs3, site_name = site_name.x)
rqs3 <- select(rqs3, -site_name.y)


rqs3 

# Creates site x zone summary data sets and merges with site type 

## Mid zone

rqs4 <- rqs3 %>%
  filter(zone == "Mid") %>%
  drop_na(fucus_pc, oyster_n) %>%
  group_by(site_code) %>%                                                          # Specify group indicator
  summarise(
    fucus_pc_avg = mean(fucus_pc),
    oyster_n_avg = mean(oyster_n),
    .groups = "keep"
  )                                                                                # Specify column, function, and new name
rqs4

rqs5 <- full_join(rqs4, rqs.loc, by = "site_code")
rqs5 <- rqs5 %>%
  select(site_code, fucus_pc_avg, oyster_n_avg, site_type, site_type2)
rqs5

##Low zone

rqs6 <- rqs3 %>%
  filter(zone == "Low") %>%
  drop_na(fucus_pc, oyster_n) %>%
  group_by(site_code) %>%                                                         # Specify group indicator
  summarise(
    fucus_pc_avg = mean(fucus_pc),
    oyster_n_avg = mean(oyster_n),
    .groups = "keep"
  )                                                                              # Specify column, function, and new name
rqs6

rqs7 <- full_join(rqs6, rqs.loc, by = "site_code")
rqs7 <- rqs7 %>%
  select(site_code, fucus_pc_avg, oyster_n_avg, site_type, site_type2)
rqs7

#sizes

# Convert zone character variable to factor variable with ordered levels
sizes1 <- sizes
mutate(sizes1, site_name = as.factor(sizes1$site_name))
ordered(
  sizes1$site_name,
  levels = c(
    "SF Marina",
    "Horseshoe Bay",
    "Dunphy Park",
    "Brickyard Park",
    "RTC Beach",
    "RTC Theater",
    "RTC North Dock",
    "Pt. Chauncey",
    "Pt. Chauncey Beach S",
    "Pt. Chauncey Beach N",
    "Paradise Beach Park",
    "Paradise Cay",
    "San Quentin Beach",
    "Starkweather Park",
    "Pt. San Pablo",
    "Pt. Orient N",
    "Pt. Orient S",
    "Pt. Molate",
    "Keller Beach",
    "Miller Knox"
  )
)

# creates OYSTER size structure data sets for ridgeline plots

oysters <- sizes1 %>%
  filter(taxon == "Oyster") %>% 
  select(site_name, size_mm)
oysters2 <-oysters %>%
  mutate(site_name = fct_reorder(site_name, size_mm))

# IMPORTANT adds dummy variable to plot site in ridge plot withOUT data plotted.will not plot anything if only one size is present, must be w/in range to not re-scale the plots on x-axis. Awkward hack, but works okay
oysters2 <- oysters2 %>% add_row(site_name = "SF Marina", size_mm = 10)
oysters2 <- oysters2 %>% add_row(site_name = "Horseshoe Bay", size_mm = 10)

oysters3 <-oysters2 %>%
  mutate(oysters2, site_name = as.factor(oysters2$site_name))
ordered(
  oysters2$site_name,
  levels = c(
    "SF Marina",
    "Horseshoe Bay",
    "Dunphy Park",
    "Brickyard Park",
    "RTC Beach",
    "RTC Theater",
    "RTC North Dock",
    "Pt. Chauncey",
    "Pt. Chauncey Beach S",
    "Pt. Chauncey Beach N",
    "Paradise Beach Park",
    "Paradise Cay",
    "San Quentin Beach",
    "Starkweather Park",
    "Pt. San Pablo",
    "Pt. Orient N",
    "Pt. Orient S",
    "Pt. Molate",
    "Keller Beach",
    "Miller Knox"
  )
)

# creates LIMPET size structure data sets for ridgeline plots

limpets <- sizes1 %>%
  filter(taxon == "Limpet") %>% 
  select(site_name, size_mm)
limpets2 <-limpets %>%
  mutate(site_name = fct_reorder(site_name, size_mm))

# IMPORTANT adds dummy variable to plot site in ridge plot withOUT data plotted.will not plot anything if only one size is present, must be w/in range to not re-scale the plots on x-axis. Awkward hack, but works okay
limpets2 <- limpets2 %>% add_row(site_name = "Pt. Orient N", size_mm = 10)
limpets2 <- limpets2 %>% add_row(site_name = "Pt. San Pablo", size_mm = 10)
limpets2 <- limpets2 %>% add_row(site_name = "Starkweather Park", size_mm = 10)
limpets2 <- limpets2 %>% add_row(site_name = "San Quentin Beach", size_mm = 10)
limpets2 <- limpets2 %>% add_row(site_name = "Paradise Cay", size_mm = 10)
limpets2 <- limpets2 %>% add_row(site_name = "Pt. Chauncey Beach S", size_mm = 10)
limpets2 <- limpets2 %>% add_row(site_name = "Pt. Chauncey", size_mm = 10)


limpets3 <-limpets2 %>%
  mutate(limpets2, site_name = as.factor(limpets2$site_name))
ordered(
  limpets2$site_name,
  levels = c(
    "SF Marina",
    "Horseshoe Bay",
    "Dunphy Park",
    "Brickyard Park",
    "RTC Beach",
    "RTC Theater",
    "RTC North Dock",
    "Pt. Chauncey",
    "Pt. Chauncey Beach S",
    "Pt. Chauncey Beach N",
    "Paradise Beach Park",
    "Paradise Cay",
    "San Quentin Beach",
    "Starkweather Park",
    "Pt. San Pablo",
    "Pt. Orient N",
    "Pt. Orient S",
    "Pt. Molate",
    "Keller Beach",
    "Miller Knox"
  )
)

# creates BAY MUSSEL size structure data sets for ridgeline plots

baymussels <- sizes1 %>%
  filter(taxon == "Mytilus") %>% 
  select(site_name, size_mm)
baymussels2 <-baymussels %>%
  mutate(site_name = fct_reorder(site_name, size_mm))

# IMPORTANT adds dummy variable to plot site in ridge plot withOUT data plotted.will not plot anything if only one size is present, must be w/in range to not re-scale the plots on x-axis. Awkward hack, but works okay
baymussels2 <- baymussels2 %>% add_row(site_name = "Pt. Orient N", size_mm = 10)


baymussels3 <-baymussels2 %>%
  mutate(baymussels2, site_name = as.factor(baymussels2$site_name))
ordered(
  baymussels2$site_name,
  levels = c(
    "SF Marina",
    "Horseshoe Bay",
    "Dunphy Park",
    "Brickyard Park",
    "RTC Beach",
    "RTC Theater",
    "RTC North Dock",
    "Pt. Chauncey",
    "Pt. Chauncey Beach S",
    "Pt. Chauncey Beach N",
    "Paradise Beach Park",
    "Paradise Cay",
    "San Quentin Beach",
    "Starkweather Park",
    "Pt. San Pablo",
    "Pt. Orient N",
    "Pt. Orient S",
    "Pt. Molate",
    "Keller Beach",
    "Miller Knox"
  )
)


rich2 <- full_join(rich, rqs.loc, by = "site_code")

rich2 <- rich2 %>% 
  mutate(RTC_sites = case_when(
        site_code %in% c("PBS", "PCR", "PCW", "PCB", "PCC", "RTCR", "RTCC", "RTCS", "SQB")  ~ "RTC",
        site_code %in% c("SWR", "SFMS", "RRR", "POC", "POB", "PMB", "MKR", "KBB", "HBR", "DPR", "BPB")  ~ "other")
  )%>%
  mutate(bay_perim_order = as.factor(bay_perim_order))%>%
  mutate(RTC_sites = as.factor(RTC_sites))

rich2 <- full_join(rich2, phys, by = "site_code")

```

# Dataviz of sfbay quadrat surveys
```{r fucus x zone, include=FALSE, fig.width = 6, fig.height = 5}

# Mid + low zone Fucus cover x site, ordered around SFBay perimeter

fucus_p1 <- rqs3 %>%
  drop_na(fucus_pc) %>%
  filter(zone != "High") %>%
  ggplot (aes(x = bay_perim_order, y = fucus_pc, fill = zone)) +
  geom_boxplot(outlier.size = 0, position = position_dodge2(preserve = "single")) +
  geom_point(pch = 21, position = position_jitterdodge()) +
  theme_few() +
  scale_fill_few(palette = "Light") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  scale_x_discrete(
  breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20),
  labels = c(
    "SF Marina",
    "Horseshoe Bay",
    "Dunphy Park",
    "Brickyard Park",
    "RTC Beach",
    "RTC Theater",
    "RTC North Dock",
    "Pt. Chauncey",
    "Pt. Chauncey Beach S",
    "Pt. Chauncey Beach N",
    "Paradise Beach Park",
    "Paradise Cay",
    "San Quentin Beach",
    "Starkweather Park",
    "Pt. San Pablo",
    "Pt. Orient N",
    "Pt. Orient S",
    "Pt. Molate",
    "Keller Beach",
    "Miller Knox"
  )
  ) +
  
  labs(x = NULL,  y = expression(paste(italic(" Fucus distichus"), " cover (%)"))) 


fucus_p1

```

```{r fucus mid, include=FALSE}

#Mid zone Fucus cover x site, ordered around SFBay perimeter, highlighting RTC sites

fucus_p2 <- rqs3 %>%
  drop_na(fucus_pc) %>%
  filter(zone == "Mid") %>%
  ggplot (aes(x = bay_perim_order, y = fucus_pc, fill = RTC_sites)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21,
             position = position_jitterdodge(
               jitter.height = 2,
               jitter.width = 1,
               seed = 7
             )) +
  scale_fill_manual(values = c("darkolivegreen4", "light grey"), drop=FALSE) +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  scale_x_discrete(
    breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20),
    labels = c(
      "SF Marina",
      "Horseshoe Bay",
      "Dunphy Park",
      "Brickyard Park",
      "RTC Beach",
      "RTC Theater",
      "RTC North Dock",
      "Pt. Chauncey",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey Beach N",
      "Paradise Beach Park",
      "Paradise Cay",
      "San Quentin Beach",
      "Starkweather Park",
      "Pt. San Pablo",
      "Pt. Orient N",
      "Pt. Orient S",
      "Pt. Molate",
      "Keller Beach",
      "Miller Knox"
    ),
    drop=FALSE
  ) +
  labs(x = NULL,  y = expression(paste(italic(" Fucus distichus"), " cover (%)"))) +
  ggtitle("Mid Zone")

fucus_p2

```

```{r fucus low, include=FALSE}

#Low zone Fucus cover x site, ordered around SFBay perimeter, highlighting RTC sites

fucus_p3 <- rqs3 %>%
  drop_na(fucus_pc) %>%
  filter(zone == "Low") %>%
  ggplot (aes(x = bay_perim_order, y = fucus_pc, fill = RTC_sites)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21,
             position = position_jitterdodge(
               jitter.height = 2,
               jitter.width = 1,
               seed = 7
             )) +
  scale_fill_manual(values = c("darkolivegreen4", "light grey"), drop=FALSE) +   
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  scale_x_discrete(
    breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20),
    labels = c(
      "SF Marina",
      "Horseshoe Bay",
      "Dunphy Park",
      "Brickyard Park",
      "RTC Beach",
      "RTC Theater",
      "RTC North Dock",
      "Pt. Chauncey",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey Beach N",
      "Paradise Beach Park",
      "Paradise Cay",
      "San Quentin Beach",
      "Starkweather Park",
      "Pt. San Pablo",
      "Pt. Orient N",
      "Pt. Orient S",
      "Pt. Molate",
      "Keller Beach",
      "Miller Knox"
    ),
    drop=FALSE
  ) +
  labs(x = NULL,  y = expression(paste(italic(" Fucus distichus"), " cover (%)"))) +
  ggtitle("Low Zone")

fucus_p3 
```

```{r fucus mid sitetype, include=FALSE}

#Mid zone Fucus cover x sitetype

fucus_p4 <- rqs5 %>%
  filter(site_type2 != "blocks") %>%
  filter(site_type2 != "seawall" ) %>%
  ggplot (aes(x = site_type2, y = fucus_pc_avg, fill=site_type2)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21,size = 3,
             position = position_jitterdodge(
               jitter.height = 0.1,
               jitter.width = 0.1,
               seed = 7
             )) +
  scale_fill_brewer(palette = "Dark2") +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  labs(x = NULL,  y = expression(paste(italic(" Fucus distichus"), " cover (%)"))) +
  ggtitle("Mid Zone")

fucus_p4 
```

```{r fucus low sitetype, include=FALSE}

#Low zone Fucus cover x sitetype

fucus_p5 <- rqs7 %>%
  filter(site_type2 != "blocks") %>%
  filter(site_type2 != "seawall") %>%
  drop_na(fucus_pc_avg) %>%
  ggplot (aes(x = site_type2, y = fucus_pc_avg, fill = site_type2)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21,size = 3,
             position = position_jitterdodge(
               jitter.height = 0.1,
               jitter.width = 0.5,
               seed = 7
             )) +
  scale_fill_brewer(palette = "Dark2") +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 0,
    vjust = 0.5,
    hjust = 0.5,
    size = rel(1.2)
  )) +
  labs(x = NULL,  y = expression(paste(italic(" Fucus distichus"), " cover (%)"))) +
  ggtitle("Low Zone")

fucus_p5 
```

```{r ostrea x zone, include=FALSE, fig.width = 9, fig.height = 6}

#Mid + Low zone native oyster density (no. per m2) x site, ordered around SFBay perimeter

oysters_p1 <- rqs3 %>%
  drop_na(oyster_n) %>%
  filter(zone != "High") %>%
  ggplot (aes(
    x = bay_perim_order,
    y = (oyster_n * 4),
    fill = zone
  )) + # density per Q * 4 = no/m2
  geom_boxplot(outlier.size = 0, position = position_dodge2(preserve = "single")) +
  geom_point(pch = 21, position = position_jitterdodge()) +
  theme_few() +
  scale_fill_few(palette = "Light") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  scale_x_discrete(
    breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20),
    labels = c(
      "SF Marina",
      "Horseshoe Bay",
      "Dunphy Park",
      "Brickyard Park",
      "RTC Beach",
      "RTC Theater",
      "RTC North Dock",
      "Pt. Chauncey",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey Beach N",
      "Paradise Beach Park",
      "Paradise Cay",
      "San Quentin Beach",
      "Starkweather Park",
      "Pt. San Pablo",
      "Pt. Orient N",
      "Pt. Orient S",
      "Pt. Molate",
      "Keller Beach",
      "Miller Knox"
    )
  )
  
  
  oysters_p1
```

```{r ostrea mid, include=FALSE}

#Mid zone native oyster density (no. per m2) x site, ordered around SFBay perimeter, highlighting RTC sites

oysters_p2 <- rqs3 %>%
  drop_na(oyster_n) %>%
  filter(zone == "Mid") %>%
  ggplot (aes(
    x = bay_perim_order,
    y = (oyster_n * 4),
    fill = RTC_sites
  )) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21,
             position = position_jitterdodge(
               jitter.height = 2,
               jitter.width = 1,
               seed = 7
             )) +
  scale_fill_manual(values = c("coral", "light grey"), drop=FALSE) +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  scale_x_discrete(
    breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20),
    labels = c(
      "SF Marina",
      "Horseshoe Bay",
      "Dunphy Park",
      "Brickyard Park",
      "RTC Beach",
      "RTC Theater",
      "RTC North Dock",
      "Pt. Chauncey",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey Beach N",
      "Paradise Beach Park",
      "Paradise Cay",
      "San Quentin Beach",
      "Starkweather Park",
      "Pt. San Pablo",
      "Pt. Orient N",
      "Pt. Orient S",
      "Pt. Molate",
      "Keller Beach",
      "Miller Knox"
    ),
    drop=FALSE
  ) +
  labs(x = NULL,  y = expression(paste(
    italic("Ostrea lurida "), "abundance ", " (no. ",  m ^ -2, ")"
  ))) +
  ggtitle("Mid Zone")

oysters_p2 

```

```{r ostrea low, include=FALSE}

#Low zone native oyster density (no. per m2) x site, ordered around SFBay perimeter, highlighting RTC sites

oysters_p3 <- rqs3 %>%
  drop_na(oyster_n) %>%
  filter(zone == "Low") %>%
  ggplot (aes(
    x = bay_perim_order,
    y = (oyster_n * 4),
    fill = RTC_sites
  )) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21,
             position = position_jitterdodge(
               jitter.height = 2,
               jitter.width = 1,
               seed = 7
             )) +
  scale_fill_manual(values = c("coral", "light grey"), drop=FALSE) +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  scale_x_discrete(
    breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20),
    labels = c(
      "SF Marina",
      "Horseshoe Bay",
      "Dunphy Park",
      "Brickyard Park",
      "RTC Beach",
      "RTC Theater",
      "RTC North Dock",
      "Pt. Chauncey",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey Beach N",
      "Paradise Beach Park",
      "Paradise Cay",
      "San Quentin Beach",
      "Starkweather Park",
      "Pt. San Pablo",
      "Pt. Orient N",
      "Pt. Orient S",
      "Pt. Molate",
      "Keller Beach",
      "Miller Knox"
    ),
    drop=FALSE
  ) +
  labs(x = NULL,  y = expression(paste(
    italic("Ostrea lurida "), "abundance ", " (no. ",  m ^ -2, ")"
  ))) +
  ggtitle("Low Zone")

oysters_p3
```

```{r ostrea mid sitetype, include=FALSE}

#Mid zone native oyster density (no. per m2) x sitetype

oyster_p4 <- rqs5 %>%
  filter(site_type2 != "blocks") %>%
  filter(site_type2 != "seawall") %>%
  drop_na(oyster_n_avg) %>%
  ggplot (aes(x = site_type2, y = oyster_n_avg * 4, fill = site_type2)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21, size = 3,
             position = position_jitterdodge(
               jitter.height = 0.5,
               jitter.width = 0.5,
               seed = 7
             )) +
  scale_fill_brewer(palette = "Set3") +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 0,
    vjust = 0.5,
    hjust = 0.5
  )) +
  labs(x = NULL,  y = expression(paste(
    italic("Ostrea lurida "), "abundance ", " (no. ",  m ^ -2, ")"
  ))) +
  ggtitle("Mid Zone")

oyster_p4 
```

```{r ostrea low sitetype, include=FALSE}

#Low zone oyster density (no. per m2) x sitetype

oyster_p5 <- rqs7 %>%
  filter(site_type2 != "blocks") %>%
  filter(site_type2 != "seawall") %>%
  drop_na(oyster_n_avg) %>%
  ggplot (aes(x = site_type2, y = oyster_n_avg * 4, fill = site_type2)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21,size = 3,
             position = position_jitterdodge(
               jitter.height = 0.5,
               jitter.width = 0.5,
               seed = 7
             )) +
  scale_fill_brewer(palette = "Set3") +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 0,
    vjust = 0.5,
    hjust = 0.5,
    size = rel(1.2)
  )) +
  labs(x = NULL,  y = expression(paste(
    italic("Ostrea lurida "), "abundance ", " (no. ",  m ^ -2, ")"
  ))) +
  ggtitle("Low Zone")

oyster_p5 
```
## Rockweed, *Fucus distichus*
```{r rockweed-by-zone-site-fig, fig.cap = " Rockweed (Fucus distichus) cover in the mid and low intertidal at survey sites. Colored fill indicates reference sites for RTC restoration planning.", fig.width = 6, fig.height = 8}

ggarrange(fucus_p2 + rremove("x.text"), fucus_p3, ncol=1, nrow=2,heights= c(0.7, 1), align = "v")
```
## Native oyster, *Ostrea lurida*
```{r oysters-by-zone-site-fig, fig.cap = " Native oyster (Ostrea lurida) abundance in the mid and low intertidal at survey sites. Colored fill indicates reference sites for RTC restoration planning.", fig.width = 6, fig.height = 8}

ggarrange(oysters_p2 + rremove("x.text"), oysters_p3, ncol=1, nrow=2,heights= c(0.7, 1), align = "v")
```
## Rockweed by site type and zone
```{r fucus-sitetype-zone-fig, fig.cap = " Cover of rockweed (Fucus distichus) in the mid and low intertidal by site type.", fig.width = 4, fig.height = 6}

ggarrange(fucus_p4 + rremove("x.text"), fucus_p5, ncol=1, nrow=2,heights= c(0.5, 0.55), align = "v")
```
## Oysters by site type and zone
```{r oysters-sitetype-zone-fig, fig.cap = " Abundance of native oysters (Ostrea lurida) in the mid and low intertidal by site type.", fig.width = 4, fig.height = 6}

ggarrange(oyster_p4 + rremove("x.text"), oyster_p5, ncol=1, nrow=2,heights= c(0.5, 0.55), align = "v")
```

```{r oysters x fucus cover, include=FALSE}
scat1 <- rqs3 %>%
  drop_na(fucus_pc, oyster_n) %>%
  filter(zone != "High") %>% 
  ggplot (aes(x = fucus_pc, y = oyster_n, color = zone)) +
  geom_point(size = 4, alpha=0.5) +
  theme_few()

scat1
```
## Oyster scars vs. oysters colored by site
```{r oyster-scar-plot, fig.cap = " Abundance of native oysters (Ostrea lurida) in the mid and low intertidal by site type.", fig.width = 10, fig.height = 4}
scat2 <- rqs3 %>%
  drop_na(oyster_n, oyster_scar_n) %>%
  filter(zone != "High") %>% 
  ggplot (aes(x = oyster_n, y = oyster_scar_n, color = site_name)) +
  geom_point(size = 3, alpha=0.6, position = position_jitterdodge()) +
  facet_wrap (~ zone)+
  theme_few()+
  guides(col = guide_legend(ncol = 2)) +
  scale_color_manual(values=as.vector(kelly(20)))  #pals color palettes issue: in ggplot2 the color vector CANNOT have names, as.vector() strips off the names from the polychrome colors

scat2
```
```{r size-structure-oysters, include=FALSE, fig.width = 6, fig.height = 10}

sz_struct_oysters <- oysters3 %>%
  mutate(
    site_name = fct_relevel(
      site_name,
      levels = "Miller Knox",
      "Keller Beach",
      "Pt. Molate",
      "Pt. Orient S",
      "Pt. Orient N",
      "Pt. San Pablo",
      "Starkweather Park",
      "San Quentin Beach",
      "Paradise Cay",
      "Paradise Beach Park",
      "Pt. Chauncey Beach N",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey",
      "RTC North Dock",
      "RTC Theater",
      "RTC Beach",
      "Brickyard Park",
      "Dunphy Park",
      "Horseshoe Bay",
      "SF Marina"
    )
  ) %>%
  
ggplot(aes(y=site_name, x=size_mm, fill=site_name))+
  geom_density_ridges(aes(point_color = site_name, point_fill = site_name),
    alpha = .2, point_alpha = 1, jittered_points = TRUE
  ) + theme_ridges()+
  theme(legend.position="none", panel.spacing = unit(0.2, "lines"),
 #         strip.text.x = element_text(size = 8)
 )+
  labs(x="", y="relative abundance")+
  ggtitle("Oysters")+
  theme(plot.title = element_text(hjust = 0.5))
sz_struct_oysters
  
  
  ## OTHER types of ridgeline and histogram plots##

  # ggplot(aes(
  #   y = site_name,
  #   x = size_mm,
  #   height = stat(density),
  #   fill = site_name
  # )) +
  # geom_density_ridges(
  #   alpha = 0.8,
  #   stat = "binline",
  #   bins = 15,
  #   scale = 0.95,
  #   draw_baseline = FALSE
  # ) +
  # theme_ridges(font_size = 12) +
  # theme(
  #   legend.position = "none",
  #   panel.spacing = unit(0.1, "lines"),
  #   strip.text.x = element_text(size = 8)
  # ) +
  # xlab("Size (mm)") +
  # ylab("Relative Frequency (%)")+
  # 

# sz_struct_oysters
 
 # ggplot(aes(y=site_name, x=size_mm,  fill=..x..)) +
 #   geom_density_ridges_gradient(scale=2, rel_min_height = 0.01) +
 #   scale_fill_viridis(name = "Size (mm)", option = "D") +
 #   theme_ridges() +
 #     theme(
 #         legend.position="none",
 #         panel.spacing = unit(0.1, "lines"),
 #         strip.text.x = element_text(size = 8)
 #     ) +
 #     xlab("") +
 #     ylab("Relative Abundance (%)") 
 #   sz_struct_oysters


 
```

```{r size-structure-limpets, include=FALSE, fig.width = 6, fig.height = 10}
sz_struct_limpets <- limpets3 %>%
  mutate(
    site_name = fct_relevel(
      site_name,
      levels = "Miller Knox",
      "Keller Beach",
      "Pt. Molate",
      "Pt. Orient S",
      "Pt. Orient N",
      "Pt. San Pablo",
      "Starkweather Park",
      "San Quentin Beach",
      "Paradise Cay",
      "Paradise Beach Park",
      "Pt. Chauncey Beach N",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey",
      "RTC North Dock",
      "RTC Theater",
      "RTC Beach",
      "Brickyard Park",
      "Dunphy Park",
      "Horseshoe Bay",
      "SF Marina"
    )
  ) %>%
  
ggplot(aes(y=site_name, x=size_mm, fill=site_name))+
  geom_density_ridges(aes(point_color = site_name, point_fill = site_name),
    alpha = .2, point_alpha = 1, jittered_points = TRUE
  ) + theme_ridges()+
  theme(legend.position="none", panel.spacing = unit(0.2, "lines"),
         # strip.text.x = element_text(size = 8)
 )+
  labs(x="Size (mm)", y="")+
  ggtitle("Limpets")+
  theme(plot.title = element_text(hjust = 0.5))
sz_struct_limpets
```

```{r size-structure-baymussels, include=FALSE, fig.width = 6, fig.height = 10}

sz_struct_baymussels <- baymussels3 %>%
  mutate(
    site_name = fct_relevel(
      site_name,
      levels = "Miller Knox",
      "Keller Beach",
      "Pt. Molate",
      "Pt. Orient S",
      "Pt. Orient N",
      "Pt. San Pablo",
      "Starkweather Park",
      "San Quentin Beach",
      "Paradise Cay",
      "Paradise Beach Park",
      "Pt. Chauncey Beach N",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey",
      "RTC North Dock",
      "RTC Theater",
      "RTC Beach",
      "Brickyard Park",
      "Dunphy Park",
      "Horseshoe Bay",
      "SF Marina"
    )
  ) %>%
  
ggplot(aes(y=site_name, x=size_mm, fill=site_name))+
  geom_density_ridges(aes(point_color = site_name, point_fill = site_name),
    alpha = .2, point_alpha = 1, jittered_points = TRUE
  ) + theme_ridges()+
  theme(legend.position="none", panel.spacing = unit(0.2, "lines"),
 #         strip.text.x = element_text(size = 8)
 )+
  labs(x="", y="")+
  ggtitle("Bay Mussels")+
  theme(plot.title = element_text(hjust = 0.5))
sz_struct_baymussels
```
## Size structure of oysters, mussels, and limpets by site
```{r size-structure-plot, fig.cap = " Size structure of oysters, bay mussels and limpets in mid and low intertidal at study sites.", message=FALSE, fig.width = 10, fig.height = 10}

ggarrange(sz_struct_oysters, sz_struct_baymussels + rremove("y.text"), sz_struct_limpets + rremove("y.text"), ncol=3, nrow=1, widths= c(1, 0.6, 0.6 ), align = "h")
```
# Dataviz of sfbay transect surveys
## Biodiversity: Richness(S) 

```{r biodiversityRTCsite, fig.cap = "Richness by site (all sources).", message=FALSE, fig.width = 6, fig.height = 5}



biodiv_s <- ggplot(subset(rich2, scale == "site"), aes(x=bay_perim_order, y=richness, fill=RTC_sites)) + 
  geom_bar(stat = "identity", color="dark grey")+
  scale_fill_manual(values = c("grey95", "thistle3"))+ 
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  scale_x_discrete(
    breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20),
    labels = c(
      "SF Marina",
      "Horseshoe Bay",
      "Dunphy Park",
      "Brickyard Park",
      "RTC Beach",
      "RTC Theater",
      "RTC North Dock",
      "Pt. Chauncey",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey Beach N",
      "Paradise Beach Park",
      "Paradise Cay",
      "San Quentin Beach",
      "Starkweather Park",
      "Pt. San Pablo",
      "Pt. Orient N",
      "Pt. Orient S",
      "Pt. Molate",
      "Keller Beach",
      "Miller Knox"
    ),
    drop=FALSE
  ) +
  labs(x = NULL,  y = "Richness (S)") +
  ggtitle("Site Biodiversity")

biodiv_s

```

```{r biodiversityRTCquads, fig.cap = "Richness by site (quadrats).", message=FALSE, fig.width = 6, fig.height = 5}


biodiv_q <- ggplot(subset(rich2, scale == "quad"), aes(x=bay_perim_order, y=richness, fill=RTC_sites)) + 
  geom_bar(stat = "identity", color="dark grey")+
  scale_fill_manual(values = c("grey95", "thistle3"))+ 
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  scale_x_discrete(
    breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20),
    labels = c(
      "SF Marina",
      "Horseshoe Bay",
      "Dunphy Park",
      "Brickyard Park",
      "RTC Beach",
      "RTC Theater",
      "RTC North Dock",
      "Pt. Chauncey",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey Beach N",
      "Paradise Beach Park",
      "Paradise Cay",
      "San Quentin Beach",
      "Starkweather Park",
      "Pt. San Pablo",
      "Pt. Orient N",
      "Pt. Orient S",
      "Pt. Molate",
      "Keller Beach",
      "Miller Knox"
    ),
    drop=FALSE
  ) +
  labs(x = NULL,  y = "Richness (S)") +
  ggtitle("Quadrat Biodiversity")

biodiv_q

```

```{r biodiversityRTCtransects, fig.cap = "Richness by site (transect).", message=FALSE, fig.width = 6, fig.height = 5}

biodiv_t <- ggplot(subset(rich2, scale == "tran"), aes(x=bay_perim_order, y=richness, fill=RTC_sites)) + 
  geom_bar(stat = "identity", color="dark grey")+
  scale_fill_manual(values = c("grey95", "thistle3"))+ 
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  scale_x_discrete(
    breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20),
    labels = c(
      "SF Marina",
      "Horseshoe Bay",
      "Dunphy Park",
      "Brickyard Park",
      "RTC Beach",
      "RTC Theater",
      "RTC North Dock",
      "Pt. Chauncey",
      "Pt. Chauncey Beach S",
      "Pt. Chauncey Beach N",
      "Paradise Beach Park",
      "Paradise Cay",
      "San Quentin Beach",
      "Starkweather Park",
      "Pt. San Pablo",
      "Pt. Orient N",
      "Pt. Orient S",
      "Pt. Molate",
      "Keller Beach",
      "Miller Knox"
    ),
    drop=FALSE
  ) +
  labs(x = NULL,  y = "Richness (S)") +
  ggtitle("Transect Biodiversity")

biodiv_t

```


## Taxonomic richness by site type
```{r Tax-rich-type-site, include=TRUE, fig.width = 6, fig.height = 5, fig.cap = "Richness by site type (site)."}
#richness x sitetype

rich3 <- rich2 %>% 
   filter(site_type2 != "blocks")
  #filter(site_type2 != "seawall") %>%

richtype_s <- ggplot(subset(rich3, scale == "site"), aes(x = site_type2, y = richness, fill = site_type2)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21, size =3,
             position = position_jitterdodge(
               jitter.height = 0.5,
               jitter.width = 0.5,
               seed = 7
             )) +
  scale_fill_brewer(palette = "Set3") +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 0,
    vjust = 0.5,
    hjust = 0.5
  )) +
  labs(x = NULL,  y = expression(paste(
    "S")
  )) +
  ggtitle("Richness by Site Type")

richtype_s
```
```{r Tax-rich-type, include=TRUE, fig.width = 6, fig.height = 5}
#richness x sitetype

rich3 <- rich2 %>% 
   filter(site_type2 != "blocks")
  #filter(site_type2 != "seawall") %>%

richtype_q <- ggplot(subset(rich3, scale == "quad"), aes(x = site_type2, y = richness, fill = site_type2)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21, size =3,
             position = position_jitterdodge(
               jitter.height = 0.5,
               jitter.width = 0.5,
               seed = 7
             )) +
  scale_fill_brewer(palette = "Set3") +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 0,
    vjust = 0.5,
    hjust = 0.5
  )) +
  labs(x = NULL,  y = expression(paste(
    "S")
  )) +
  ggtitle("Richness by Site Type - quadrats")

richtype_q
```



```{r Tax-rich-type-tran, include=TRUE, fig.width = 6, fig.height = 5, fig.cap = "Richness by site type (transect)."}
#richness x sitetype

rich3 <- rich2 %>% 
   filter(site_type2 != "blocks")
  #filter(site_type2 != "seawall") %>%

richtype_t <- ggplot(subset(rich3, scale == "tran"), aes(x = site_type2, y = richness, fill = site_type2)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(pch = 21, size =3,
             position = position_jitterdodge(
               jitter.height = 0.5,
               jitter.width = 0.5,
               seed = 7
             )) +
  scale_fill_brewer(palette = "Set3") +
  theme_few() +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(
    angle = 0,
    vjust = 0.5,
    hjust = 0.5
  )) +
  labs(x = NULL,  y = expression(paste(
    "S")
  )) +
  ggtitle("Richness by Site Type")

richtype_t
```

## Species richness vs. intertidal width
```{r rich-width-scale, include=TRUE, fig.width = 12, fig.height = 5, fig.cap = "Richness by intertidal width."}

rich4 <- rich3 %>%
  filter(site_type2 != "seawall")

# Convert zone character variable to factor variable with ordered levels
rich4 <-
  within(rich4, scale <-
           factor(scale, levels = c("quad", "tran", "site")))
with(rich4, levels(scale))


SwidthAll <-
  ggplot(rich4, aes(x = width_avg_m, y = richness, color = site_type2)) +
  geom_point(size = 3,
             alpha = 0.6) +
  facet_wrap (~ scale) +
  theme_few() +
  guides(col = guide_legend(ncol = 1))
SwidthAll

```


## Species richness vs. intertidal slope
```{r rich-slope-scale, include=TRUE, fig.width = 12, fig.height = 5, fig.cap = "Richness by intertidal slope."}

SslopeAll <-
  ggplot(rich4, aes(x = slope_avg, y = richness, color = site_type2)) +
  geom_point(size = 3,
             alpha = 0.6) +
  facet_wrap (~ scale) +
  theme_few() +
  guides(col = guide_legend(ncol = 1))
SslopeAll

```

## Species richness vs. intertidal rugosity
```{r rich-rug-scale, include=TRUE, fig.width = 12, fig.height = 5, fig.cap = "Richness by intertidal rugosity."}

SrugAll <-
  ggplot(rich4, aes(x = rugosity_avg, y = richness, color = site_type2)) +
  geom_point(size = 3,
             alpha = 0.6) +
  facet_wrap (~ scale) +
  theme_few() +
  guides(col = guide_legend(ncol = 1))
SrugAll

# SrugAlllm <-
#   ggplot(rich4, aes(x = rugosity_avg, y = richness)) +
#   geom_point(size = 3,
#              alpha = 0.6) +
#   geom_smooth(method = lm) +
#   facet_wrap (~ scale) +
#   theme_few() +
#   guides(col = guide_legend(ncol = 1))
# SrugAlllm

```



```{r morewrangling}
coverbio_wide_s[is.na(coverbio_wide_s)] <- 0
coverbio_wide_s <- column_to_rownames(coverbio_wide_s, var = "ftu")
coverbio_m <- as.matrix(coverbio_wide_s)
```

```{r heatmap_transects, include=FALSE, fig.width = 12, fig.height = 12}
# coverbio_m_scale = scale(coverbio_m)
pheatmap(coverbio_m)
```
```{r tilemapPREP}

coverbio_site <- aggregate(cover ~ ftu + site, coverbio_long_s, mean)

coverbio_site_class <- coverbio_site %>%
  # convert site to factor and order by bay perimeter
  mutate(site = factor(site)) %>%
  mutate(
    site = fct_relevel(
      site,
      "SFMS",
      "HBR",
      "DPR",
      "BPB",
      "RTCC",
      "RTCS",
      "RTCR",
      "PCW",
      "PCC",
      "PCB",
      "PBS",
      "PCR",
      "SQB",
      "SWR",
      "RRR",
      "POC",
      "POB",
      "PMB",
      "KBB",
      "MKR"
    )
  ) %>%
  mutate(site=
    fct_recode(
      site,
      "SF Marina" = "SFMS",
      "Horseshoe Bay" = "HBR",
      "Dunphy Park" = "DPR",
      "Brickyard Park" = "BPB",
      "RTC Beach" = "RTCC",
      "RTC Theater" = "RTCS",
      "RTC North Dock" = "RTCR",
      "Pt. Chauncey" = "PCW",
      "Pt. Chauncey Beach S" = "PCC",
      "Pt. Chauncey Beach N" = "PCB",
      "Paradise Beach Park" = "PBS",
      "Paradise Cay" = "PCR",
      "San Quentin Beach" = "SQB",
      "Starkweather Park" = "SWR",
      "Pt. San Pablo" = "RRR",
      "Pt. Orient N" = "POC",
      "Pt. Orient S" = "POB",
      "Pt. Molate" = "PMB",
      "Keller Beach" = "KBB",
      "Miller Knox" = "MKR"
    )
  ) %>%
# create a new variable from cover
  mutate(coverclass = cut(
    cover,
    breaks = c(-1, 0, 1, 2, 4, 8, 16, 32, 64, 100, max(cover, na.rm = T)),
    labels = c(
      "0",
      "0-1",
      "1-2",
      "2-4",
      "4-8",
      "8-16",
      "16-32",
      "32-64",
      "64-100",
      ">100"
    )
  )) %>%
  # change level order
  mutate(coverclass = factor(as.character(coverclass), levels = rev(levels(coverclass)))) %>%

  # convert ftu to factor and order by functional groups
  mutate(ftu = factor(ftu)) %>%
  mutate(
    ftu = fct_relevel(
      ftu,
      "ulsp",
      "ulen",
      "brsp",
      "grfi",
      "diat",
      "fudi",
      "samu",
      "mapa",
      "recr",
      "pysp",
      "caok",
      "posp",
      "chex",
      "maja",
      "capi",
      "hasc",
      "masp",
      "cocr",
      "crwo",
      "crypt",
      "grsp",
      "pica",
      "pola",
      "prsp",
      "refi",
      "lich",
      "basp",
      "chsp",
      "oslu",
      "mysp",
      "clam",
      "dili",
      "schi",
      "enbr"
    )
  ) %>% 
  mutate(
    ftu =
      fct_recode(
        ftu,
        "Ulva spp." = "ulsp",
        "Ulva enteromorpha" = "ulen",
        "Bryopsis sp." = "brsp",
        "Green filamentous sp." = "grfi",
        "diatoms" = "diat",
        "Fucus distichus" = "fudi",
        "Sargassum muticum" = "samu",
        "Mastocarpus papillatus" = "mapa",
        "Red crust" = "recr",
        "Pyropia sp." = "pysp",
        "Caulacanthus okamurae" = "caok",
        "Polysiphonia sp." = "posp",
        "Chondracanthus exasperatus" = "chex",
        "Mastocarpus jardinii" = "maja",
        "Callithamnion pikeanum" = "capi",
        "Halymenia schizymenioides" = "hasc",
        "Mazzaella spp." = "masp",
        "Coralline crust" = "cocr",
        "Cryptosiphonia woodii" = "crwo",
        "SF marina species" = "crypt",
        "Grateloupia sp." = "grsp",
        "Pikea californica" = "pica",
        "Polyneura latissma" = "pola",
        "Prionitis sp." = "prsp",
        "Red filamentous algae" = "refi",
        "Lichen" = "lich",
        "Balanoid spp." = "basp",
        "Chthalamus spp." = "chsp",
        "Ostrea lurida" = "oslu",
        "Mytilus spp." = "mysp",
        "unidentified clam" = "clam",
        "Diadumene lineata" = "dili",
        "Schizoporella sp." = "schi",
        "Encrusting Bryozoan spp." = "enbr"
      )
  ) %>%
  # change level order
  mutate(ftu = factor(as.character(ftu), levels = rev(levels(ftu)))) 

coverbio_site_class_x = bind_rows(coverbio_site_class, hmextra,.id=NULL)


```

## Cover of sessile species
```{r tilemap, include=TRUE, fig.width = 10, fig.height = 10, fig.cap = "Cover of sessile taxa by site."}
library(RColorBrewer)
p2 <- ggplot(coverbio_site_class_x, aes(x = site, y = ftu )) +
  geom_tile(data = filter(coverbio_site_class_x, ftu != 'Region', site != 'Taxonomic group'), aes(fill = coverclass)) +
  coord_equal() +
  scale_y_discrete(limits = rev(sort(unique(coverbio_site_class_x$ftu)))) +
  theme_classic() + theme(strip.background = element_blank())+
  
p2 +
  geom_point(data = filter(coverbio_site_class_x, ftu == 'Region' | site == 'Taxonomic group'), 
            aes(col = coverclass), size = 9.2, shape = 15) +
  scale_fill_manual(values=rev(brewer.pal(8,"GnBu")),na.value="grey90")+
  geom_tile(colour="grey90",size=0.2)+
  theme(axis.text.x = element_text(angle = 45, hjust=1))+
  labs(title="Cover of sessile taxonomic groups", x="Sites", y= "Taxon group") 

p2

```


```{r, include=FALSE}
## save figure to output folder
# ggsave(here::here("output","oyster_quad_counts.pdf"), width = 20, height = 20, units = "cm")
```

```{r, include=FALSE}
##what's up with Keller Beach mid zone oyster count?
#used this to figure out outlier issue and correct original data file (was a date entry error). #Updated the file in github with a commit note to explain the change.
#saving code chunk here for reference only

# t1 <- rqs3 %>% 
#   group_by(zone, site_name)%>%
#   summarise(min_cov= min(oyster_n, na.rm = TRUE), Q1=quantile(oyster_n, probs = 0.25, na.rm = TRUE), median_cov = median(oyster_n, na.rm = TRUE), Q3=quantile(oyster_n, probs = 0.75, na.rm = TRUE), max_cov = max(oyster_n, na.rm = TRUE)) %>% 
#   arrange(min_cov, Q1, median_cov, Q3, max_cov)
# t1
```


